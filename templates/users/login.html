{% extends 'base.html' %}
{% load static %}
{% load socialaccount %}

{% block title %}Login to Your Account - GiftTree{% endblock %}

{% block meta_description %}Login to GiftTree to access your account, track orders, manage wishlist, and enjoy faster checkout on flowers, cakes, and gifts.{% endblock %}

{% block content %}
<style>
/* Auth Page Styles */
.auth-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background: linear-gradient(135deg, #FFF8F0 0%, #FFE8E8 100%);
}

.auth-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 450px;
    overflow: hidden;
    animation: fadeInUp 0.6s ease-out;
}

.auth-header {
    background: var(--pink-gradient);
    padding: 40px 30px;
    text-align: center;
    color: white;
}

.auth-header h1 {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 8px;
}

.auth-header p {
    font-size: 14px;
    opacity: 0.9;
}

.auth-body {
    padding: 40px 30px;
}

.form-group {
    margin-bottom: 24px;
}

.form-label {
    display: block;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 8px;
    font-size: 14px;
}

.form-control {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #E0E0E0;
    border-radius: 12px;
    font-size: 15px;
    font-family: 'Poppins', sans-serif;
    transition: all 0.3s ease;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(233, 30, 99, 0.1);
}

.input-icon {
    position: relative;
}

.input-icon i {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-light);
    font-size: 16px;
}

.input-icon .form-control {
    padding-left: 45px;
}

.password-toggle {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-light);
    cursor: pointer;
    font-size: 16px;
}

.form-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.remember-me {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: var(--text-dark);
}

.remember-me input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
}

.forgot-password {
    color: var(--primary-color);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
}

.forgot-password:hover {
    text-decoration: underline;
}

.btn-login {
    width: 100%;
    padding: 16px;
    background: var(--pink-gradient);
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3);
}

.btn-login:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(233, 30, 99, 0.4);
}

.btn-login:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.divider {
    display: flex;
    align-items: center;
    margin: 30px 0;
    color: var(--text-light);
    font-size: 14px;
}

.divider::before,
.divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: #E0E0E0;
}

.divider span {
    padding: 0 15px;
}

.social-login {
    display: flex;
    gap: 12px;
    margin-bottom: 30px;
    justify-content: center;
}

.social-btn {
    flex: 1;
    padding: 12px;
    border: 2px solid #E0E0E0;
    border-radius: 12px;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-decoration: none;
    color: inherit;
}

.social-btn:hover {
    border-color: var(--primary-color);
    background: rgba(233, 30, 99, 0.05);
    text-decoration: none;
}

.google-btn {
    width: 100%;
    padding: 12px 24px;
    border: 2px solid #E0E0E0;
    border-radius: 12px;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 15px;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    text-decoration: none;
    color: #444;
}

.google-btn:hover {
    border-color: #4285F4;
    background: rgba(66, 133, 244, 0.05);
    text-decoration: none;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    color: inherit;
}

.social-btn i {
    font-size: 18px;
}

    .google-btn {
        color: #DB4437;
    }

    /* Google Sign-In Button Styling */
    .g_id_signin {
        width: 100%;
        margin-top: 10px;
    }

    /* Override Google's default styling */
    .g_id_signin > div {
        width: 100% !important;
        height: 50px !important;
        border-radius: 8px !important;
        border: 2px solid #e0e0e0 !important;
        background: white !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-family: 'Poppins', sans-serif !important;
        font-weight: 500 !important;
        font-size: 14px !important;
        color: #333 !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
    }

    .g_id_signin > div:hover {
        border-color: #DB4437 !important;
        background: rgba(219, 68, 55, 0.05) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
    }

    .g_id_signin > div:active {
        transform: translateY(0) !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
    }

    /* Google logo styling */
    .g_id_signin svg {
        width: 20px !important;
        height: 20px !important;
        margin-right: 12px !important;
    }

    /* Text styling */
    .g_id_signin span {
        font-family: 'Poppins', sans-serif !important;
        font-weight: 500 !important;
        font-size: 14px !important;
        color: #333 !important;
    }

    /* Mobile responsive styling */
    @media (max-width: 768px) {
        .g_id_signin > div {
            height: 48px !important;
            font-size: 13px !important;
        }
        
        .g_id_signin svg {
            width: 18px !important;
            height: 18px !important;
            margin-right: 10px !important;
        }
        
        .g_id_signin span {
            font-size: 13px !important;
        }
    }

.auth-footer {
    text-align: center;
    padding: 20px 30px 30px;
    border-top: 1px solid #F0F0F0;
}

.auth-footer p {
    color: var(--text-light);
    font-size: 14px;
    margin: 0;
}

.auth-footer a {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 600;
}

.auth-footer a:hover {
    text-decoration: underline;
}

.alert {
    padding: 12px 16px;
    border-radius: 12px;
    margin-bottom: 24px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.alert-success {
    background: #D4EDDA;
    color: #155724;
    border: 1px solid #C3E6CB;
}

.alert-error {
    background: #F8D7DA;
    color: #721C24;
    border: 1px solid #F5C6CB;
}

.alert-info {
    background: #D1ECF1;
    color: #0C5460;
    border: 1px solid #BEE5EB;
}

.alert i {
    font-size: 16px;
}

@media (max-width: 768px) {
    .auth-container {
        padding: 0;
        align-items: flex-start;
    }
    
    .auth-card {
        border-radius: 0;
        min-height: 100vh;
    }
    
    .auth-header {
        padding: 30px 20px;
    }
    
    .auth-body {
        padding: 30px 20px;
    }
    
    .form-options {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
}
</style>

<div class="auth-container">
    <div class="auth-card">
        <!-- Header -->
        <div class="auth-header">
            <h1>Welcome Back!</h1>
            <p>Login to continue shopping</p>
        </div>

        <!-- Body -->
        <div class="auth-body">
            <!-- Display Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Display Form Errors -->
            {% if form.non_field_errors %}
                <div class="alert alert-error">
                    <i class="fas fa-exclamation-circle"></i>
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Login Form -->
            <form method="POST" action="{% url 'users:login' %}" id="loginForm">
                {% csrf_token %}
                
                <!-- Email/Username -->
                <div class="form-group">
                    <label class="form-label">Email or Username</label>
                    <div class="input-icon">
                        <i class="fas fa-envelope"></i>
                        <input type="text" 
                               name="username" 
                               class="form-control" 
                               placeholder="Enter your email or username"
                               value="{{ form.username.value|default:'' }}"
                               required>
                    </div>
                    {% if form.username.errors %}
                        <div class="error-message">
                            <i class="fas fa-exclamation-circle"></i>
                            {{ form.username.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <!-- Password -->
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="input-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" 
                               name="password" 
                               id="password"
                               class="form-control" 
                               placeholder="Enter your password"
                               required>
                        <button type="button" class="password-toggle" onclick="togglePassword()">
                            <i class="fas fa-eye" id="toggleIcon"></i>
                        </button>
                    </div>
                    {% if form.password.errors %}
                        <div class="error-message">
                            <i class="fas fa-exclamation-circle"></i>
                            {{ form.password.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <!-- Remember Me & Forgot Password -->
                <div class="form-options">
                    <label class="remember-me">
                        <input type="checkbox" name="remember_me">
                        <span>Remember me</span>
                    </label>
                    <a href="{% url 'users:password_reset' %}" class="forgot-password">
                        Forgot Password?
                    </a>
                </div>

                <!-- Hidden next field to redirect after login -->
                {% if next %}
                    <input type="hidden" name="next" value="{{ next }}">
                {% endif %}

                <!-- Login Button -->
                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt"></i> Login to Account
                </button>
            </form>

            <!-- Divider -->
            <div class="divider">
                <span>or continue with</span>
            </div>

            <!-- Social Login -->
            <div class="social-login">
                <a href="{% provider_login_url 'google' %}" class="google-btn">
                    <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                        <g fill="none" fill-rule="evenodd">
                            <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
                            <path d="M9.003 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.96v2.332C2.44 15.983 5.485 18 9.003 18z" fill="#34A853"/>
                            <path d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707 0-.593.102-1.17.282-1.709V4.958H.957C.347 6.173 0 7.548 0 9c0 1.452.348 2.827.957 4.042l3.007-2.335z" fill="#FBBC05"/>
                            <path d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.426 0 9.003 0 5.485 0 2.44 2.017.96 4.958L3.967 7.29c.708-2.127 2.692-3.71 5.036-3.71z" fill="#EA4335"/>
                        </g>
                    </svg>
                    <span>Continue with Google</span>
                </a>
            </div>
        </div>

        <!-- Footer -->
        <div class="auth-footer">
            <p>
                Don't have an account? 
                <a href="{% url 'users:register' %}">Create one now</a>
            </p>
        </div>
    </div>
</div>

<script>
// Toggle password visibility
function togglePassword() {
    const passwordField = document.getElementById('password');
    const toggleIcon = document.getElementById('toggleIcon');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
    } else {
        passwordField.type = 'password';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
    }
}

// Google OAuth is handled by django-allauth

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}